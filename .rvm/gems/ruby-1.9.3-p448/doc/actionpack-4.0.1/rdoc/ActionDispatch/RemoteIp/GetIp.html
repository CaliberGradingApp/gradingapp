<!DOCTYPE html>

<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">

<title>class ActionDispatch::RemoteIp::GetIp - actionpack-4.0.1 Documentation</title>

<link type="text/css" media="screen" href="../../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../../";
</script>

<script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/navigation.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search_index.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/search.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/searcher.js"></script>
<script type="text/javascript" charset="utf-8" src="../../js/darkfish.js"></script>


<body id="top" class="class">
<nav id="metadata">
  <nav id="home-section" class="section">
  <h3 class="section-header">
    <a href="../../index.html">Home</a>
    <a href="../../table_of_contents.html#classes">Classes</a>
    <a href="../../table_of_contents.html#methods">Methods</a>
  </h3>
</nav>


  <nav id="search-section" class="section project-section" class="initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <h3 class="section-header">
      <input type="text" name="search" placeholder="Search" id="search-field"
             title="Type to search, Up and Down to navigate, Enter to load">
    </h3>
  </form>

  <ul id="search-results" class="initially-hidden"></ul>
</nav>


  <div id="file-metadata">
    <nav id="file-list-section" class="section">
  <h3 class="section-header">Defined In</h3>
  <ul>
    <li>lib/action_dispatch/middleware/remote_ip.rb
  </ul>
</nav>

    
  </div>

  <div id="class-metadata">
    
    <nav id="parent-class-section" class="section">
  <h3 class="section-header">Parent</h3>
  
  <p class="link"><a href="../../Object.html">Object</a>
  
</nav>

    
    <!-- Method Quickref -->
<nav id="method-list-section" class="section">
  <h3 class="section-header">Methods</h3>

  <ul class="link-list">
    
    <li><a href="#method-c-new">::new</a>
    
    <li><a href="#method-i-calculate_ip">#calculate_ip</a>
    
    <li><a href="#method-i-filter_proxies">#filter_proxies</a>
    
    <li><a href="#method-i-ips_from">#ips_from</a>
    
    <li><a href="#method-i-to_s">#to_s</a>
    
  </ul>
</nav>

  </div>

  <div id="project-metadata">
    
    <nav id="classindex-section" class="section project-section">
  <h3 class="section-header">Class and Module Index</h3>

  <ul class="link-list">
  
    <li><a href="../../ActionDispatch.html">ActionDispatch</a>
  
    <li><a href="../../ActionDispatch/Assertions.html">ActionDispatch::Assertions</a>
  
    <li><a href="../../ActionDispatch/Assertions/DomAssertions.html">ActionDispatch::Assertions::DomAssertions</a>
  
    <li><a href="../../ActionDispatch/Assertions/ResponseAssertions.html">ActionDispatch::Assertions::ResponseAssertions</a>
  
    <li><a href="../../ActionDispatch/Assertions/RoutingAssertions.html">ActionDispatch::Assertions::RoutingAssertions</a>
  
    <li><a href="../../ActionDispatch/Assertions/SelectorAssertions.html">ActionDispatch::Assertions::SelectorAssertions</a>
  
    <li><a href="../../ActionDispatch/Assertions/TagAssertions.html">ActionDispatch::Assertions::TagAssertions</a>
  
    <li><a href="../../ActionDispatch/Callbacks.html">ActionDispatch::Callbacks</a>
  
    <li><a href="../../ActionDispatch/Cookies.html">ActionDispatch::Cookies</a>
  
    <li><a href="../../ActionDispatch/Cookies/ChainedCookieJars.html">ActionDispatch::Cookies::ChainedCookieJars</a>
  
    <li><a href="../../ActionDispatch/Cookies/VerifyAndUpgradeLegacySignedMessage.html">ActionDispatch::Cookies::VerifyAndUpgradeLegacySignedMessage</a>
  
    <li><a href="../../ActionDispatch/DebugExceptions.html">ActionDispatch::DebugExceptions</a>
  
    <li><a href="../../ActionDispatch/ExceptionWrapper.html">ActionDispatch::ExceptionWrapper</a>
  
    <li><a href="../../ActionDispatch/FileHandler.html">ActionDispatch::FileHandler</a>
  
    <li><a href="../../ActionDispatch/Flash.html">ActionDispatch::Flash</a>
  
    <li><a href="../../ActionDispatch/Flash/FlashHash.html">ActionDispatch::Flash::FlashHash</a>
  
    <li><a href="../../ActionDispatch/Http.html">ActionDispatch::Http</a>
  
    <li><a href="../../ActionDispatch/Http/Cache.html">ActionDispatch::Http::Cache</a>
  
    <li><a href="../../ActionDispatch/Http/Cache/Request.html">ActionDispatch::Http::Cache::Request</a>
  
    <li><a href="../../ActionDispatch/Http/Cache/Response.html">ActionDispatch::Http::Cache::Response</a>
  
    <li><a href="../../ActionDispatch/Http/FilterParameters.html">ActionDispatch::Http::FilterParameters</a>
  
    <li><a href="../../ActionDispatch/Http/FilterRedirect.html">ActionDispatch::Http::FilterRedirect</a>
  
    <li><a href="../../ActionDispatch/Http/Headers.html">ActionDispatch::Http::Headers</a>
  
    <li><a href="../../ActionDispatch/Http/MimeNegotiation.html">ActionDispatch::Http::MimeNegotiation</a>
  
    <li><a href="../../ActionDispatch/Http/ParameterFilter.html">ActionDispatch::Http::ParameterFilter</a>
  
    <li><a href="../../ActionDispatch/Http/Parameters.html">ActionDispatch::Http::Parameters</a>
  
    <li><a href="../../ActionDispatch/Http/URL.html">ActionDispatch::Http::URL</a>
  
    <li><a href="../../ActionDispatch/Http/UploadedFile.html">ActionDispatch::Http::UploadedFile</a>
  
    <li><a href="../../ActionDispatch/IllegalStateError.html">ActionDispatch::IllegalStateError</a>
  
    <li><a href="../../ActionDispatch/Integration.html">ActionDispatch::Integration</a>
  
    <li><a href="../../ActionDispatch/Integration.html">ActionDispatch::Integration</a>
  
    <li><a href="../../ActionDispatch/Integration/RequestHelpers.html">ActionDispatch::Integration::RequestHelpers</a>
  
    <li><a href="../../ActionDispatch/Integration/Runner.html">ActionDispatch::Integration::Runner</a>
  
    <li><a href="../../ActionDispatch/Integration/Session.html">ActionDispatch::Integration::Session</a>
  
    <li><a href="../../ActionDispatch/IntegrationTest.html">ActionDispatch::IntegrationTest</a>
  
    <li><a href="../../ActionDispatch/IntegrationTest.html">ActionDispatch::IntegrationTest</a>
  
    <li><a href="../../ActionDispatch/MiddlewareStack.html">ActionDispatch::MiddlewareStack</a>
  
    <li><a href="../../ActionDispatch/MiddlewareStack/Middleware.html">ActionDispatch::MiddlewareStack::Middleware</a>
  
    <li><a href="../../ActionDispatch/ParamsParser.html">ActionDispatch::ParamsParser</a>
  
    <li><a href="../../ActionDispatch/ParamsParser/ParseError.html">ActionDispatch::ParamsParser::ParseError</a>
  
    <li><a href="../../ActionDispatch/PublicExceptions.html">ActionDispatch::PublicExceptions</a>
  
    <li><a href="../../ActionDispatch/RailsEntityStore.html">ActionDispatch::RailsEntityStore</a>
  
    <li><a href="../../ActionDispatch/RailsMetaStore.html">ActionDispatch::RailsMetaStore</a>
  
    <li><a href="../../ActionDispatch/Reloader.html">ActionDispatch::Reloader</a>
  
    <li><a href="../../ActionDispatch/RemoteIp.html">ActionDispatch::RemoteIp</a>
  
    <li><a href="../../ActionDispatch/RemoteIp/GetIp.html">ActionDispatch::RemoteIp::GetIp</a>
  
    <li><a href="../../ActionDispatch/RemoteIp/IpSpoofAttackError.html">ActionDispatch::RemoteIp::IpSpoofAttackError</a>
  
    <li><a href="../../ActionDispatch/Request.html">ActionDispatch::Request</a>
  
    <li><a href="../../ActionDispatch/RequestId.html">ActionDispatch::RequestId</a>
  
    <li><a href="../../ActionDispatch/Response.html">ActionDispatch::Response</a>
  
    <li><a href="../../ActionDispatch/Routing.html">ActionDispatch::Routing</a>
  
    <li><a href="../../ActionDispatch/Routing.html">ActionDispatch::Routing</a>
  
    <li><a href="../../ActionDispatch/Routing/ConsoleFormatter.html">ActionDispatch::Routing::ConsoleFormatter</a>
  
    <li><a href="../../ActionDispatch/Routing/HtmlTableFormatter.html">ActionDispatch::Routing::HtmlTableFormatter</a>
  
    <li><a href="../../ActionDispatch/Routing/Mapper.html">ActionDispatch::Routing::Mapper</a>
  
    <li><a href="../../ActionDispatch/Routing/Mapper/Base.html">ActionDispatch::Routing::Mapper::Base</a>
  
    <li><a href="../../ActionDispatch/Routing/Mapper/Concerns.html">ActionDispatch::Routing::Mapper::Concerns</a>
  
    <li><a href="../../ActionDispatch/Routing/Mapper/HttpHelpers.html">ActionDispatch::Routing::Mapper::HttpHelpers</a>
  
    <li><a href="../../ActionDispatch/Routing/Mapper/Resources.html">ActionDispatch::Routing::Mapper::Resources</a>
  
    <li><a href="../../ActionDispatch/Routing/Mapper/Scoping.html">ActionDispatch::Routing::Mapper::Scoping</a>
  
    <li><a href="../../ActionDispatch/Routing/PathRedirect.html">ActionDispatch::Routing::PathRedirect</a>
  
    <li><a href="../../ActionDispatch/Routing/PolymorphicRoutes.html">ActionDispatch::Routing::PolymorphicRoutes</a>
  
    <li><a href="../../ActionDispatch/Routing/Redirection.html">ActionDispatch::Routing::Redirection</a>
  
    <li><a href="../../ActionDispatch/Routing/RouteWrapper.html">ActionDispatch::Routing::RouteWrapper</a>
  
    <li><a href="../../ActionDispatch/Routing/UrlFor.html">ActionDispatch::Routing::UrlFor</a>
  
    <li><a href="../../ActionDispatch/SSL.html">ActionDispatch::SSL</a>
  
    <li><a href="../../ActionDispatch/Session.html">ActionDispatch::Session</a>
  
    <li><a href="../../ActionDispatch/Session/AbstractStore.html">ActionDispatch::Session::AbstractStore</a>
  
    <li><a href="../../ActionDispatch/Session/CacheStore.html">ActionDispatch::Session::CacheStore</a>
  
    <li><a href="../../ActionDispatch/Session/Compatibility.html">ActionDispatch::Session::Compatibility</a>
  
    <li><a href="../../ActionDispatch/Session/CookieStore.html">ActionDispatch::Session::CookieStore</a>
  
    <li><a href="../../ActionDispatch/Session/MemCacheStore.html">ActionDispatch::Session::MemCacheStore</a>
  
    <li><a href="../../ActionDispatch/Session/StaleSessionCheck.html">ActionDispatch::Session::StaleSessionCheck</a>
  
    <li><a href="../../ActionDispatch/ShowExceptions.html">ActionDispatch::ShowExceptions</a>
  
    <li><a href="../../ActionDispatch/Static.html">ActionDispatch::Static</a>
  
    <li><a href="../../ActionDispatch/TestProcess.html">ActionDispatch::TestProcess</a>
  
    <li><a href="../../ActionDispatch/TestRequest.html">ActionDispatch::TestRequest</a>
  
    <li><a href="../../ActionDispatch/TestResponse.html">ActionDispatch::TestResponse</a>
  
    <li><a href="../../ActionController.html">ActionController</a>
  
    <li><a href="../../ActionController/ActionController.html">ActionController::ActionController</a>
  
    <li><a href="../../ActionController/ActionController/ActionController.html">ActionController::ActionController::ActionController</a>
  
    <li><a href="../../ActionController/Base.html">ActionController::Base</a>
  
    <li><a href="../../ActionController/Caching.html">ActionController::Caching</a>
  
    <li><a href="../../ActionController/Caching/ClassMethods.html">ActionController::Caching::ClassMethods</a>
  
    <li><a href="../../ActionController/Caching/ConfigMethods.html">ActionController::Caching::ConfigMethods</a>
  
    <li><a href="../../ActionController/Caching/Fragments.html">ActionController::Caching::Fragments</a>
  
    <li><a href="../../ActionController/ConditionalGet.html">ActionController::ConditionalGet</a>
  
    <li><a href="../../ActionController/ConditionalGet/ClassMethods.html">ActionController::ConditionalGet::ClassMethods</a>
  
    <li><a href="../../ActionController/Cookies.html">ActionController::Cookies</a>
  
    <li><a href="../../ActionController/DataStreaming.html">ActionController::DataStreaming</a>
  
    <li><a href="../../ActionController/Flash.html">ActionController::Flash</a>
  
    <li><a href="../../ActionController/Flash/ClassMethods.html">ActionController::Flash::ClassMethods</a>
  
    <li><a href="../../ActionController/ForceSSL.html">ActionController::ForceSSL</a>
  
    <li><a href="../../ActionController/ForceSSL/ClassMethods.html">ActionController::ForceSSL::ClassMethods</a>
  
    <li><a href="../../ActionController/Head.html">ActionController::Head</a>
  
    <li><a href="../../ActionController/Helpers.html">ActionController::Helpers</a>
  
    <li><a href="../../ActionController/Helpers/ClassMethods.html">ActionController::Helpers::ClassMethods</a>
  
    <li><a href="../../ActionController/HideActions.html">ActionController::HideActions</a>
  
    <li><a href="../../ActionController/HideActions/ClassMethods.html">ActionController::HideActions::ClassMethods</a>
  
    <li><a href="../../ActionController/HttpAuthentication.html">ActionController::HttpAuthentication</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Basic.html">ActionController::HttpAuthentication::Basic</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Basic/ControllerMethods.html">ActionController::HttpAuthentication::Basic::ControllerMethods</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Basic/ControllerMethods/ClassMethods.html">ActionController::HttpAuthentication::Basic::ControllerMethods::ClassMethods</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Digest.html">ActionController::HttpAuthentication::Digest</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Digest/ControllerMethods.html">ActionController::HttpAuthentication::Digest::ControllerMethods</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Token.html">ActionController::HttpAuthentication::Token</a>
  
    <li><a href="../../ActionController/HttpAuthentication/Token/ControllerMethods.html">ActionController::HttpAuthentication::Token::ControllerMethods</a>
  
    <li><a href="../../ActionController/ImplicitRender.html">ActionController::ImplicitRender</a>
  
    <li><a href="../../ActionController/Instrumentation.html">ActionController::Instrumentation</a>
  
    <li><a href="../../ActionController/Instrumentation/ClassMethods.html">ActionController::Instrumentation::ClassMethods</a>
  
    <li><a href="../../ActionController/Live.html">ActionController::Live</a>
  
    <li><a href="../../ActionController/Live/Response.html">ActionController::Live::Response</a>
  
    <li><a href="../../ActionController/LogSubscriber.html">ActionController::LogSubscriber</a>
  
    <li><a href="../../ActionController/Metal.html">ActionController::Metal</a>
  
    <li><a href="../../ActionController/Middleware.html">ActionController::Middleware</a>
  
    <li><a href="../../ActionController/Middleware/ActionMiddleware.html">ActionController::Middleware::ActionMiddleware</a>
  
    <li><a href="../../ActionController/MimeResponds.html">ActionController::MimeResponds</a>
  
    <li><a href="../../ActionController/MimeResponds/ClassMethods.html">ActionController::MimeResponds::ClassMethods</a>
  
    <li><a href="../../ActionController/MimeResponds/Collector.html">ActionController::MimeResponds::Collector</a>
  
    <li><a href="../../ActionController/ModelNaming.html">ActionController::ModelNaming</a>
  
    <li><a href="../../ActionController/ParameterMissing.html">ActionController::ParameterMissing</a>
  
    <li><a href="../../ActionController/Parameters.html">ActionController::Parameters</a>
  
    <li><a href="../../ActionController/ParamsWrapper.html">ActionController::ParamsWrapper</a>
  
    <li><a href="../../ActionController/ParamsWrapper/ClassMethods.html">ActionController::ParamsWrapper::ClassMethods</a>
  
    <li><a href="../../ActionController/RackDelegation.html">ActionController::RackDelegation</a>
  
    <li><a href="../../ActionController/Railties.html">ActionController::Railties</a>
  
    <li><a href="../../ActionController/Railties/Helpers.html">ActionController::Railties::Helpers</a>
  
    <li><a href="../../ActionController/RecordIdentifier.html">ActionController::RecordIdentifier</a>
  
    <li><a href="../../ActionController/Redirecting.html">ActionController::Redirecting</a>
  
    <li><a href="../../ActionController/Renderers.html">ActionController::Renderers</a>
  
    <li><a href="../../ActionController/Renderers/All.html">ActionController::Renderers::All</a>
  
    <li><a href="../../ActionController/Renderers/ClassMethods.html">ActionController::Renderers::ClassMethods</a>
  
    <li><a href="../../ActionController/Rendering.html">ActionController::Rendering</a>
  
    <li><a href="../../ActionController/RequestForgeryProtection.html">ActionController::RequestForgeryProtection</a>
  
    <li><a href="../../ActionController/RequestForgeryProtection/ClassMethods.html">ActionController::RequestForgeryProtection::ClassMethods</a>
  
    <li><a href="../../ActionController/RequestForgeryProtection/ProtectionMethods.html">ActionController::RequestForgeryProtection::ProtectionMethods</a>
  
    <li><a href="../../ActionController/RequestForgeryProtection/ProtectionMethods/Exception.html">ActionController::RequestForgeryProtection::ProtectionMethods::Exception</a>
  
    <li><a href="../../ActionController/RequestForgeryProtection/ProtectionMethods/NullSession.html">ActionController::RequestForgeryProtection::ProtectionMethods::NullSession</a>
  
    <li><a href="../../ActionController/RequestForgeryProtection/ProtectionMethods/ResetSession.html">ActionController::RequestForgeryProtection::ProtectionMethods::ResetSession</a>
  
    <li><a href="../../ActionController/Rescue.html">ActionController::Rescue</a>
  
    <li><a href="../../ActionController/Responder.html">ActionController::Responder</a>
  
    <li><a href="../../ActionController/Streaming.html">ActionController::Streaming</a>
  
    <li><a href="../../ActionController/StrongParameters.html">ActionController::StrongParameters</a>
  
    <li><a href="../../ActionController/TemplateAssertions.html">ActionController::TemplateAssertions</a>
  
    <li><a href="../../ActionController/TestCase.html">ActionController::TestCase</a>
  
    <li><a href="../../ActionController/TestCase/Behavior.html">ActionController::TestCase::Behavior</a>
  
    <li><a href="../../ActionController/TestCase/Behavior/ClassMethods.html">ActionController::TestCase::Behavior::ClassMethods</a>
  
    <li><a href="../../ActionController/TestCase/RaiseActionExceptions.html">ActionController::TestCase::RaiseActionExceptions</a>
  
    <li><a href="../../ActionController/TestResponse.html">ActionController::TestResponse</a>
  
    <li><a href="../../ActionController/Testing.html">ActionController::Testing</a>
  
    <li><a href="../../ActionController/Testing/ClassMethods.html">ActionController::Testing::ClassMethods</a>
  
    <li><a href="../../ActionController/UnpermittedParameters.html">ActionController::UnpermittedParameters</a>
  
    <li><a href="../../ActionController/UrlFor.html">ActionController::UrlFor</a>
  
    <li><a href="../../ActionView.html">ActionView</a>
  
    <li><a href="../../ActionView/Base.html">ActionView::Base</a>
  
    <li><a href="../../ActionView/Context.html">ActionView::Context</a>
  
    <li><a href="../../ActionView/DependencyTracker.html">ActionView::DependencyTracker</a>
  
    <li><a href="../../ActionView/DependencyTracker/ERBTracker.html">ActionView::DependencyTracker::ERBTracker</a>
  
    <li><a href="../../ActionView/Digestor.html">ActionView::Digestor</a>
  
    <li><a href="../../ActionView/FileSystemResolver.html">ActionView::FileSystemResolver</a>
  
    <li><a href="../../ActionView/FixtureResolver.html">ActionView::FixtureResolver</a>
  
    <li><a href="../../ActionView/Helpers.html">ActionView::Helpers</a>
  
    <li><a href="../../ActionView/Helpers/ActiveModelHelper.html">ActionView::Helpers::ActiveModelHelper</a>
  
    <li><a href="../../ActionView/Helpers/ActiveModelInstanceTag.html">ActionView::Helpers::ActiveModelInstanceTag</a>
  
    <li><a href="../../ActionView/Helpers/AssetTagHelper.html">ActionView::Helpers::AssetTagHelper</a>
  
    <li><a href="../../ActionView/Helpers/AssetUrlHelper.html">ActionView::Helpers::AssetUrlHelper</a>
  
    <li><a href="../../ActionView/Helpers/AtomFeedHelper.html">ActionView::Helpers::AtomFeedHelper</a>
  
    <li><a href="../../ActionView/Helpers/CacheHelper.html">ActionView::Helpers::CacheHelper</a>
  
    <li><a href="../../ActionView/Helpers/CaptureHelper.html">ActionView::Helpers::CaptureHelper</a>
  
    <li><a href="../../ActionView/Helpers/CsrfHelper.html">ActionView::Helpers::CsrfHelper</a>
  
    <li><a href="../../ActionView/Helpers/DateHelper.html">ActionView::Helpers::DateHelper</a>
  
    <li><a href="../../ActionView/Helpers/DebugHelper.html">ActionView::Helpers::DebugHelper</a>
  
    <li><a href="../../ActionView/Helpers/FormBuilder.html">ActionView::Helpers::FormBuilder</a>
  
    <li><a href="../../ActionView/Helpers/FormHelper.html">ActionView::Helpers::FormHelper</a>
  
    <li><a href="../../ActionView/Helpers/FormOptionsHelper.html">ActionView::Helpers::FormOptionsHelper</a>
  
    <li><a href="../../ActionView/Helpers/FormTagHelper.html">ActionView::Helpers::FormTagHelper</a>
  
    <li><a href="../../ActionView/Helpers/JavaScriptHelper.html">ActionView::Helpers::JavaScriptHelper</a>
  
    <li><a href="../../ActionView/Helpers/NumberHelper.html">ActionView::Helpers::NumberHelper</a>
  
    <li><a href="../../ActionView/Helpers/NumberHelper/InvalidNumberError.html">ActionView::Helpers::NumberHelper::InvalidNumberError</a>
  
    <li><a href="../../ActionView/Helpers/OutputSafetyHelper.html">ActionView::Helpers::OutputSafetyHelper</a>
  
    <li><a href="../../ActionView/Helpers/RecordTagHelper.html">ActionView::Helpers::RecordTagHelper</a>
  
    <li><a href="../../ActionView/Helpers/RenderingHelper.html">ActionView::Helpers::RenderingHelper</a>
  
    <li><a href="../../ActionView/Helpers/SanitizeHelper.html">ActionView::Helpers::SanitizeHelper</a>
  
    <li><a href="../../ActionView/Helpers/TagHelper.html">ActionView::Helpers::TagHelper</a>
  
    <li><a href="../../ActionView/Helpers/TextHelper.html">ActionView::Helpers::TextHelper</a>
  
    <li><a href="../../ActionView/Helpers/TranslationHelper.html">ActionView::Helpers::TranslationHelper</a>
  
    <li><a href="../../ActionView/Helpers/UrlHelper.html">ActionView::Helpers::UrlHelper</a>
  
    <li><a href="../../ActionView/Helpers/UrlHelper/ClassMethods.html">ActionView::Helpers::UrlHelper::ClassMethods</a>
  
    <li><a href="../../ActionView/LogSubscriber.html">ActionView::LogSubscriber</a>
  
    <li><a href="../../ActionView/LookupContext.html">ActionView::LookupContext</a>
  
    <li><a href="../../ActionView/LookupContext/DetailsCache.html">ActionView::LookupContext::DetailsCache</a>
  
    <li><a href="../../ActionView/LookupContext/ViewPaths.html">ActionView::LookupContext::ViewPaths</a>
  
    <li><a href="../../ActionView/ModelNaming.html">ActionView::ModelNaming</a>
  
    <li><a href="../../ActionView/NullResolver.html">ActionView::NullResolver</a>
  
    <li><a href="../../ActionView/PartialRenderer.html">ActionView::PartialRenderer</a>
  
    <li><a href="../../ActionView/RecordIdentifier.html">ActionView::RecordIdentifier</a>
  
    <li><a href="../../ActionView/Renderer.html">ActionView::Renderer</a>
  
    <li><a href="../../ActionView/Resolver.html">ActionView::Resolver</a>
  
    <li><a href="../../ActionView/Resolver/Cache.html">ActionView::Resolver::Cache</a>
  
    <li><a href="../../ActionView/Resolver/Cache/SmallCache.html">ActionView::Resolver::Cache::SmallCache</a>
  
    <li><a href="../../ActionView/Resolver/Path.html">ActionView::Resolver::Path</a>
  
    <li><a href="../../ActionView/RoutingUrlFor.html">ActionView::RoutingUrlFor</a>
  
    <li><a href="../../ActionView/Template.html">ActionView::Template</a>
  
    <li><a href="../../ActionView/Template/Handlers.html">ActionView::Template::Handlers</a>
  
    <li><a href="../../ActionView/Template/Handlers/Builder.html">ActionView::Template::Handlers::Builder</a>
  
    <li><a href="../../ActionView/Template/Handlers/ERB.html">ActionView::Template::Handlers::ERB</a>
  
    <li><a href="../../ActionView/Template/Handlers/Erubis.html">ActionView::Template::Handlers::Erubis</a>
  
    <li><a href="../../ActionView/Template/Handlers/Raw.html">ActionView::Template::Handlers::Raw</a>
  
    <li><a href="../../ActionView/Template/Types.html">ActionView::Template::Types</a>
  
    <li><a href="../../ActionView/Template/Types/Type.html">ActionView::Template::Types::Type</a>
  
    <li><a href="../../ActionView/TestCase.html">ActionView::TestCase</a>
  
    <li><a href="../../ActionView/TestCase/Behavior.html">ActionView::TestCase::Behavior</a>
  
    <li><a href="../../ActionView/TestCase/Behavior/ClassMethods.html">ActionView::TestCase::Behavior::ClassMethods</a>
  
    <li><a href="../../ActionView/TestCase/Behavior/Locals.html">ActionView::TestCase::Behavior::Locals</a>
  
    <li><a href="../../ActionView/TestCase/Behavior/RenderedViewsCollection.html">ActionView::TestCase::Behavior::RenderedViewsCollection</a>
  
    <li><a href="../../ActionView/TestCase/TestController.html">ActionView::TestCase::TestController</a>
  
    <li><a href="../../AbstractController.html">AbstractController</a>
  
    <li><a href="../../AbstractController/Base.html">AbstractController::Base</a>
  
    <li><a href="../../AbstractController/Callbacks.html">AbstractController::Callbacks</a>
  
    <li><a href="../../AbstractController/Callbacks/ClassMethods.html">AbstractController::Callbacks::ClassMethods</a>
  
    <li><a href="../../AbstractController/Collector.html">AbstractController::Collector</a>
  
    <li><a href="../../AbstractController/DoubleRenderError.html">AbstractController::DoubleRenderError</a>
  
    <li><a href="../../AbstractController/Helpers.html">AbstractController::Helpers</a>
  
    <li><a href="../../AbstractController/Helpers/ClassMethods.html">AbstractController::Helpers::ClassMethods</a>
  
    <li><a href="../../AbstractController/Helpers/ClassMethods/MissingHelperError.html">AbstractController::Helpers::ClassMethods::MissingHelperError</a>
  
    <li><a href="../../AbstractController/Layouts.html">AbstractController::Layouts</a>
  
    <li><a href="../../AbstractController/Layouts/ClassMethods.html">AbstractController::Layouts::ClassMethods</a>
  
    <li><a href="../../AbstractController/Railties.html">AbstractController::Railties</a>
  
    <li><a href="../../AbstractController/Railties/RoutesHelpers.html">AbstractController::Railties::RoutesHelpers</a>
  
    <li><a href="../../AbstractController/Rendering.html">AbstractController::Rendering</a>
  
    <li><a href="../../AbstractController/Rendering/ClassMethods.html">AbstractController::Rendering::ClassMethods</a>
  
    <li><a href="../../AbstractController/Translation.html">AbstractController::Translation</a>
  
    <li><a href="../../AbstractController/UrlFor.html">AbstractController::UrlFor</a>
  
    <li><a href="../../AbstractController/UrlFor/ClassMethods.html">AbstractController::UrlFor::ClassMethods</a>
  
    <li><a href="../../AbstractController/ViewPaths.html">AbstractController::ViewPaths</a>
  
    <li><a href="../../AbstractController/ViewPaths/ClassMethods.html">AbstractController::ViewPaths::ClassMethods</a>
  
    <li><a href="../../HTML.html">HTML</a>
  
    <li><a href="../../HTML/FullSanitizer.html">HTML::FullSanitizer</a>
  
    <li><a href="../../HTML/LinkSanitizer.html">HTML::LinkSanitizer</a>
  
    <li><a href="../../HTML/Sanitizer.html">HTML::Sanitizer</a>
  
    <li><a href="../../HTML/Selector.html">HTML::Selector</a>
  
    <li><a href="../../HTML/Tag.html">HTML::Tag</a>
  
    <li><a href="../../HTML/WhiteListSanitizer.html">HTML::WhiteListSanitizer</a>
  
    <li><a href="../../Mime.html">Mime</a>
  
    <li><a href="../../Mime/Mimes.html">Mime::Mimes</a>
  
    <li><a href="../../Mime/NullType.html">Mime::NullType</a>
  
    <li><a href="../../Mime/Type.html">Mime::Type</a>
  
    <li><a href="../../Object.html">Object</a>
  
    <li><a href="../../ActionDispatch/Integration.html">Object::Integration</a>
  
    <li><a href="../../ActionDispatch/IntegrationTest.html">Object::IntegrationTest</a>
  
    <li><a href="../../ActionDispatch/Routing.html">Object::Routing</a>
  
    <li><a href="../../I18n.html">I18n</a>
  
    <li><a href="../../I18n/ExceptionHandler.html">I18n::ExceptionHandler</a>
  
    <li><a href="../../ActionPack.html">ActionPack</a>
  
  </ul>
</nav>

  </div>
</nav>

<div id="documentation">
  <h1 class="class">class ActionDispatch::RemoteIp::GetIp</h1>

  <div id="description" class="description">
    
<p>The <a href="GetIp.html">GetIp</a> class exists as a way to defer
processing of the request data into an actual IP address. If the <a
href="../Request.html#method-i-remote_ip">ActionDispatch::Request#remote_ip</a>
method is called, this class will calculate the value and then memoize it.</p>

  </div><!-- description -->

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <!-- Constants -->
    <section id="constants-list" class="section">
      <h3 class="section-header">Constants</h3>
      <dl>
      
        <dt id="VALID_IP">VALID_IP
        
        <dd class="description"><p>This constant contains a regular expression that validates every known form
of IP v4 and v6 address, with or without abbreviations, adapted from <a
href="https://gist.github.com/gazay/1289635">this gist</a>.</p>
        
      
      </dl>
    </section>
    

    

    <!-- Methods -->
    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Class Methods</h3>

    
      <div id="method-c-new" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">(env, middleware)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/remote_ip.rb, line 109</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">env</span>, <span class="ruby-identifier">middleware</span>)
  <span class="ruby-ivar">@env</span>      = <span class="ruby-identifier">env</span>
  <span class="ruby-ivar">@check_ip</span> = <span class="ruby-identifier">middleware</span>.<span class="ruby-identifier">check_ip</span>
  <span class="ruby-ivar">@proxies</span>  = <span class="ruby-identifier">middleware</span>.<span class="ruby-identifier">proxies</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- new-source -->
          
        </div>

        

        
      </div><!-- new-method -->

    
    </section><!-- public-class-method-details -->
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Public Instance Methods</h3>

    
      <div id="method-i-calculate_ip" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">calculate_ip</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Sort through the various IP address headers, looking for the IP most likely
to be the address of the actual remote client making this request.</p>

<p>REMOTE_ADDR will be correct if the request is made directly against the
Ruby process, on e.g. Heroku. When the request is proxied by another server
like HAProxy or Nginx, the IP address that made the original request will
be put in an X-Forwarded-For header. If there are multiple proxies, that
header may contain a list of IPs. Other proxy services set the Client-Ip
header instead, so we check that too.</p>

<p>As discussed in <a
href="http://blog.gingerlime.com/2012/rails-ip-spoofing-vulnerabilities-and-protection/">this
post about Rails IP Spoofing</a>, while the first IP in the list is likely
to be the “originating” IP, it could also have been set by the client
maliciously.</p>

<p>In order to find the first address that is (probably) accurate, we take the
list of IPs, remove known and trusted proxies, and then take the last
address left, which was presumably set by one of those proxies.</p>
          

          
          <div class="method-source-code" id="calculate_ip-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/remote_ip.rb, line 133</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">calculate_ip</span>
  <span class="ruby-comment"># Set by the Rack web server, this is a single value.</span>
  <span class="ruby-identifier">remote_addr</span> = <span class="ruby-identifier">ips_from</span>(<span class="ruby-string">'REMOTE_ADDR'</span>).<span class="ruby-identifier">last</span>

  <span class="ruby-comment"># Could be a CSV list and/or repeated headers that were concatenated.</span>
  <span class="ruby-identifier">client_ips</span>    = <span class="ruby-identifier">ips_from</span>(<span class="ruby-string">'HTTP_CLIENT_IP'</span>).<span class="ruby-identifier">reverse</span>
  <span class="ruby-identifier">forwarded_ips</span> = <span class="ruby-identifier">ips_from</span>(<span class="ruby-string">'HTTP_X_FORWARDED_FOR'</span>).<span class="ruby-identifier">reverse</span>

  <span class="ruby-comment"># +Client-Ip+ and +X-Forwarded-For+ should not, generally, both be set.</span>
  <span class="ruby-comment"># If they are both set, it means that this request passed through two</span>
  <span class="ruby-comment"># proxies with incompatible IP header conventions, and there is no way</span>
  <span class="ruby-comment"># for us to determine which header is the right one after the fact.</span>
  <span class="ruby-comment"># Since we have no idea, we give up and explode.</span>
  <span class="ruby-identifier">should_check_ip</span> = <span class="ruby-ivar">@check_ip</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">client_ips</span>.<span class="ruby-identifier">last</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">forwarded_ips</span>.<span class="ruby-identifier">last</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">should_check_ip</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">forwarded_ips</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">client_ips</span>.<span class="ruby-identifier">last</span>)
    <span class="ruby-comment"># We don't know which came from the proxy, and which from the user</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">IpSpoofAttackError</span>, <span class="ruby-string">&quot;IP spoofing attack?! &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;HTTP_CLIENT_IP=#{@env['HTTP_CLIENT_IP'].inspect} &quot;</span> <span class="ruby-operator">+</span>
      <span class="ruby-node">&quot;HTTP_X_FORWARDED_FOR=#{@env['HTTP_X_FORWARDED_FOR'].inspect}&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># We assume these things about the IP headers:</span>
  <span class="ruby-comment">#</span>
  <span class="ruby-comment">#   - X-Forwarded-For will be a list of IPs, one per proxy, or blank</span>
  <span class="ruby-comment">#   - Client-Ip is propagated from the outermost proxy, or is blank</span>
  <span class="ruby-comment">#   - REMOTE_ADDR will be the IP that made the request to Rack</span>
  <span class="ruby-identifier">ips</span> = [<span class="ruby-identifier">forwarded_ips</span>, <span class="ruby-identifier">client_ips</span>, <span class="ruby-identifier">remote_addr</span>].<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">compact</span>

  <span class="ruby-comment"># If every single IP option is in the trusted list, just return REMOTE_ADDR</span>
  <span class="ruby-identifier">filter_proxies</span>(<span class="ruby-identifier">ips</span>).<span class="ruby-identifier">first</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">remote_addr</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- calculate_ip-source -->
          
        </div>

        

        
      </div><!-- calculate_ip-method -->

    
      <div id="method-i-to_s" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">to_s</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          <p>Memoizes the value returned by <a
href="GetIp.html#method-i-calculate_ip">calculate_ip</a> and returns it for
<a href="../Request.html">ActionDispatch::Request</a> to use.</p>
          

          
          <div class="method-source-code" id="to_s-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/remote_ip.rb, line 167</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">to_s</span>
  <span class="ruby-ivar">@ip</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">calculate_ip</span>
<span class="ruby-keyword">end</span></pre>
          </div><!-- to_s-source -->
          
        </div>

        

        
      </div><!-- to_s-method -->

    
    </section><!-- public-instance-method-details -->
  
     <section id="protected-instance-5Buntitled-5D-method-details" class="method-section section">
      <h3 class="section-header">Protected Instance Methods</h3>

    
      <div id="method-i-filter_proxies" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">filter_proxies</span><span
            class="method-args">(ips)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="filter_proxies-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/remote_ip.rb, line 180</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">filter_proxies</span>(<span class="ruby-identifier">ips</span>)
  <span class="ruby-identifier">ips</span>.<span class="ruby-identifier">reject</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">ip</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ip</span> <span class="ruby-operator">=~</span> <span class="ruby-ivar">@proxies</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- filter_proxies-source -->
          
        </div>

        

        
      </div><!-- filter_proxies-method -->

    
      <div id="method-i-ips_from" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ips_from</span><span
            class="method-args">(header)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>
        

        <div class="method-description">
          
          
          

          
          <div class="method-source-code" id="ips_from-source">
            <pre><span class="ruby-comment"># File lib/action_dispatch/middleware/remote_ip.rb, line 173</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ips_from</span>(<span class="ruby-identifier">header</span>)
  <span class="ruby-comment"># Split the comma-separated list into an array of strings</span>
  <span class="ruby-identifier">ips</span> = <span class="ruby-ivar">@env</span>[<span class="ruby-identifier">header</span>] <span class="ruby-operator">?</span> <span class="ruby-ivar">@env</span>[<span class="ruby-identifier">header</span>].<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/[,\s]+/</span>) <span class="ruby-operator">:</span> []
  <span class="ruby-comment"># Only return IPs that are valid according to the regex</span>
  <span class="ruby-identifier">ips</span>.<span class="ruby-identifier">select</span>{ <span class="ruby-operator">|</span><span class="ruby-identifier">ip</span><span class="ruby-operator">|</span> <span class="ruby-identifier">ip</span> <span class="ruby-operator">=~</span> <span class="ruby-constant">VALID_IP</span> }
<span class="ruby-keyword">end</span></pre>
          </div><!-- ips_from-source -->
          
        </div>

        

        
      </div><!-- ips_from-method -->

    
    </section><!-- protected-instance-method-details -->
  
  </section><!-- 5Buntitled-5D -->

</div><!-- documentation -->


<footer id="validator-badges">
  <p><a href="http://validator.w3.org/check/referer">[Validate]</a>
  <p>Generated by <a href="https://github.com/rdoc/rdoc">RDoc</a> 3.12.2.
  <p>Generated with the <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish Rdoc Generator</a> 3.
</footer>

